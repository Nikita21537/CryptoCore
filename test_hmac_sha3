import pytest
from cryptocore.mac import hmac_sha3_256, hmac_sha3_256_hex


class TestHMACSHA3_256:

    
    # Тестовые векторы для HMAC-SHA3-256
    TEST_VECTORS = [
        # (key, message, expected_hex)
        (
            b"key",
            b"The quick brown fox jumps over the lazy dog",
            "3a6e54c2c72cdf5d4d2103b3c4d0c4b5b0b5c5d5e5f6a6b7c8d9e0f1a2b3c4d"
        ),
        (
            b"test",
            b"hello world",
            "7d3e0b5a7c9d1e3f5a7b9d1f3a5c7e9b1d3f5a7c9e1b3d5f7a9c1e3b5d7f9a"
        ),
        # RFC 4231-подобные тесты адаптированные для SHA3
        (
            b"0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b",
            b"Hi There",
            "test_vector_placeholder"  # Нужны реальные тестовые векторы
        ),
    ]
    
    def test_hmac_sha3_256_basic(self):
        
        key = b"secret"
        message = b"hello world"
        
        hmac_result = hmac_sha3_256(key, message)
        
        assert len(hmac_result) == 32  # 256 бит = 32 байта
        assert hmac_result != b'\x00' * 32  # Не должен быть нулевым
    
    def test_hmac_sha3_256_hex(self):
      
        key = b"test"
        message = b"data"
        
        hex_result = hmac_sha3_256_hex(key, message)
        bytes_result = hmac_sha3_256(key, message).hex()
        
        assert hex_result == bytes_result
        assert len(hex_result) == 64  # 32 байта в hex = 64 символа
    
    def test_hmac_sha3_256_different_keys(self):
       
        message = b"same message"
        
        hmac1 = hmac_sha3_256(b"key1", message)
        hmac2 = hmac_sha3_256(b"key2", message)
        
        assert hmac1 != hmac2
    
    def test_hmac_sha3_256_different_messages(self):
      
        key = b"same key"
        
        hmac1 = hmac_sha3_256(key, b"message1")
        hmac2 = hmac_sha3_256(key, b"message2")
        
        assert hmac1 != hmac2
    
    def test_hmac_sha3_256_long_key(self):
        
        key = b"x" * 200  # Длиннее блока SHA3 (136 байт)
        message = b"test"
        
        hmac_result = hmac_sha3_256(key, message)
        
        assert len(hmac_result) == 32
    
    def test_hmac_sha3_256_string_input(self):
        
        hex_result = hmac_sha3_256_hex("secret", "message")
        bytes_result = hmac_sha3_256(b"secret", b"message").hex()
        
        assert hex_result == bytes_result
    
    def test_hmac_sha3_256_consistency(self):
      
        key = b"key"
        message = b"message"
        
        # Многократное вычисление должно давать одинаковый результат
        results = set()
        for _ in range(10):
            results.add(hmac_sha3_256_hex(key, message))
        
        assert len(results) == 1  # Все результаты одинаковые
    
    @pytest.mark.parametrize("key,message,expected", TEST_VECTORS[:2])
    def test_hmac_sha3_256_vectors(self, key, message, expected):
    "
        # Пока пропускаем, нужны реальные тестовые векторы
        # result = hmac_sha3_256_hex(key, message)
        # assert result == expected
        pass


class TestHMACComparison:
   
    
    def test_hmac_sha256_vs_sha3_256(self):
      
        from cryptocore.mac import hmac_sha256_hex
        
        key = b"test key"
        message = b"test message"
        
        hmac_sha256 = hmac_sha256_hex(key, message)
        hmac_sha3_256 = hmac_sha3_256_hex(key, message)
        
        # Они должны быть разные (разные хеш-функции)
        assert hmac_sha256 != hmac_sha3_256
        
        # Но оба должны быть валидными HMAC
        assert len(hmac_sha256) == 64
        assert len(hmac_sha3_256) == 64
